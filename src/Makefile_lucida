
CC=gcc
CXX=g++ -std=gnu++17

RLIBPATH=/Users/gabrielhoffman/prog/R-4.4.0/library



CPPFLAGS=-I../inst/include \
	-I $(RLIBPATH)/RcppArmadillo/include \
	-I $(RLIBPATH)/beachmat/include \
	-I $(RLIBPATH)/Rhtslib/include \
	-I $(RLIBPATH)/BH/include \
	-I $(RLIBPATH)/vcfppR/include \
	-I $(RLIBPATH)/Rhtslib/include/ \
	-I ../inst/include/ \
	-I ../inst/include/zstd-1.1.0/lib  \
	-I ../inst/include/zstd-1.1.0/lib/common  \
	-I ../inst/include/zstd-1.1.0/lib/compress  \
	-I ../inst/include/zstd-1.1.0/lib/decompress  \
	-I $(RLIBPATH)/../include \
	-I. \
	-D DISABLE_EIGEN \
	-D DISABLE_RCPP \
	-D DISABLE_DELAYED_STREAM \
	-D SQLITE_ENABLE_COLUMN_METADATA \
	-D SQLITE_ENABLE_STAT4 \
	-D SQLITE_MAX_EXPR_DEPTH=10000 \
	-D SQLITE_USE_URI=1 \
	-D SQLITE_WITHOUT_ZONEMALLOC \
	-fPIC -O2 -fdiagnostics-color=always


C_SOURCES = $(wildcard zstd-1.1.0/*.c) $(wildcard sqlite3/*.c)
C_OBJECTS = $(patsubst %.c,%.o,$(C_SOURCES)) 
CXX_SOURCES = $(wildcard bgen/*.cpp) $(wildcard boost/*.cpp) $(wildcard db/*.cpp)
CXX_OBJECTS = $(patsubst %.cpp,%.o,$(CXX_SOURCES))
OBJECTS = lucida.o $(CXX_OBJECTS) $(C_OBJECTS) 
  

LDFLAGS=-L/opt/homebrew/Cellar/gcc/14.1.0_1/lib/gcc/current \
	-lgfortran -lquadmath -lcurl -lbz2 -llzma -lz -llapack -lblas \
	-D DISABLE_EIGEN \
	-D DISABLE_RCPP \
	-D DISABLE_DELAYED_STREAM \
	$(RLIBPATH)/Rhtslib/usrlib/libhts.a 



lucida: $(OBJECTS)
	$(CXX) $(LDFLAGS) -o lucida $(OBJECTS) $(LDLIBS)

lucida.o: ../inst/lucida.cpp
	$(CXX) $(CPPFLAGS) -c ../inst/lucida.cpp -o lucida.o 

clean:
	rm -f $(OBJECTS) lucida
